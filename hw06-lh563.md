hw06-lh563
================
Lu Han
11/1/2018

Homework 06
===========

``` r
suppressPackageStartupMessages(library(tidyverse))
suppressPackageStartupMessages(library(gapminder))
```

Task 02
-------

### Working with functions

First, let's filter the data of China

``` r
(gap<- gapminder %>% 
  filter(country == "China"))
```

    ## # A tibble: 12 x 6
    ##    country continent  year lifeExp        pop gdpPercap
    ##    <fct>   <fct>     <int>   <dbl>      <int>     <dbl>
    ##  1 China   Asia       1952    44    556263527      400.
    ##  2 China   Asia       1957    50.5  637408000      576.
    ##  3 China   Asia       1962    44.5  665770000      488.
    ##  4 China   Asia       1967    58.4  754550000      613.
    ##  5 China   Asia       1972    63.1  862030000      677.
    ##  6 China   Asia       1977    64.0  943455000      741.
    ##  7 China   Asia       1982    65.5 1000281000      962.
    ##  8 China   Asia       1987    67.3 1084035000     1379.
    ##  9 China   Asia       1992    68.7 1164970000     1656.
    ## 10 China   Asia       1997    70.4 1230075000     2289.
    ## 11 China   Asia       2002    72.0 1280400000     3119.
    ## 12 China   Asia       2007    73.0 1318683096     4959.

Plot the data.

``` r
p <- ggplot(gap, aes(x = year, y = gdpPercap))
p + geom_point() + geom_smooth(method = "lm", se = FALSE)
```

![](hw06-lh563_files/figure-markdown_github/unnamed-chunk-3-1.png) Fit the linear regression model

``` r
gap_lm <- lm(gdpPercap~year,data=gap)
coef(gap_lm)
```

    ##   (Intercept)          year 
    ## -127509.31555      65.16677

From the previous graph, we can tell the linear regression is not a good model for the data as most of the dots do not fall on the line. From the coefficient, we can tell that when year=0, gdpPercap=intercept=-127509.31555 , which does not make sense. Hence, a quadratic regression model is applied to fit the data.

``` r
gap_qm<- lm(gdpPercap~I(year)+I(year^2),data=gap)
coef(gap_qm)
```

    ##   (Intercept)       I(year)     I(year^2) 
    ## 8958302.83646   -9115.43742       2.31892

The intercept is too large when the year=0. Hence, according to Jenny's tutorial, an offset of 1952 was applied.

``` r
gap_qm2<- lm(gdpPercap~I(year-1952)+I(year^2-1952^2),data=gap)
coef(gap_qm2)
```

    ##        (Intercept)     I(year - 1952) I(year^2 - 1952^2) 
    ##          759.05981        -9115.43742            2.31892

Create the function to do the coefficent automatically

``` r
coef_function <- function(gap, offset=1952){
  gap_fit <-lm(gdpPercap~I(year-1952)+I(year^2-1952^2),data=gap)
  setNames(coef(gap_fit),c("intercept","year","year^2"))
}
coef_function(gap)
```

    ##   intercept        year      year^2 
    ##   759.05981 -9115.43742     2.31892

The values of intercept matches the previous coefficient values, suggesting the function created works.

Let's try with another country's data.

``` r
(gap2 <- gapminder %>% 
  filter(country == "Australia"))
```

    ## # A tibble: 12 x 6
    ##    country   continent  year lifeExp      pop gdpPercap
    ##    <fct>     <fct>     <int>   <dbl>    <int>     <dbl>
    ##  1 Australia Oceania    1952    69.1  8691212    10040.
    ##  2 Australia Oceania    1957    70.3  9712569    10950.
    ##  3 Australia Oceania    1962    70.9 10794968    12217.
    ##  4 Australia Oceania    1967    71.1 11872264    14526.
    ##  5 Australia Oceania    1972    71.9 13177000    16789.
    ##  6 Australia Oceania    1977    73.5 14074100    18334.
    ##  7 Australia Oceania    1982    74.7 15184200    19477.
    ##  8 Australia Oceania    1987    76.3 16257249    21889.
    ##  9 Australia Oceania    1992    77.6 17481977    23425.
    ## 10 Australia Oceania    1997    78.8 18565243    26998.
    ## 11 Australia Oceania    2002    80.4 19546792    30688.
    ## 12 Australia Oceania    2007    81.2 20434176    34435.

``` r
coef_function(gap2)
```

    ##     intercept          year        year^2 
    ##  10238.816096 -16819.826077      4.356322

``` r
p2 <- ggplot(gap2, aes(x = year, y = gdpPercap))
p2 + geom_point() + geom_smooth(method = "lm", formula = y ~ x + I(x^2), se = FALSE)
```

![](hw06-lh563_files/figure-markdown_github/unnamed-chunk-8-1.png) The quadratic model fits the data well as we can see most of the dots fall on the line and the intercept is positive values not.

Task 02
-------

### Working with functions
